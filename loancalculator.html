<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Responsive Loan Calculator</title>

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ====== Root Colors ====== */
:root {
  --background: #ffffff;
  --foreground: #222222;
  --highlight: #0083b0;
  --button: #00b4db;
  --panel-bg: #f4f4f4;
}
body.dark-mode {
  --background: #121212;
  --foreground: #eeeeee;
  --highlight: #00d2ff;
  --button: #0077aa;
  --panel-bg: #222222;
}

/* ====== Global Styles ====== */
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body {
  height: 100%;
  background-color: var(--background);
  color: var(--foreground);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  transition: background-color 0.3s, color 0.3s;
}
.container {
  width: 100vw;
  max-width: 540px;
  height: 90vh;
  background-color: var(--panel-bg);
  border-radius: 12px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  padding: 0.6rem 0.8rem;
  overflow: hidden;
}
.toggle-mode {
  text-align: right;
  margin-bottom: 0.4rem;
}
.toggle-mode button {
  background: none;
  border: none;
  color: var(--highlight);
  font-size: 1rem;
  cursor: pointer;
}
h1 {
  text-align: center;
  margin-bottom: 0.5rem;
  color: var(--highlight);
  font-size: 1.4rem;
  user-select: none;
}
form {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 34vh;
  gap: 0.5rem;
  overflow: hidden;
}
.input-group {
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
}
label {
  font-weight: 600;
  font-size: 0.9rem;
  user-select: none;
}
input, select {
  width: 100%;
  padding: 0.3rem 0.5rem;
  font-size: 0.95rem;
  border-radius: 6px;
  border: 1.5px solid #ccc;
  background-color: var(--background);
  color: var(--foreground);
  transition: border-color 0.2s;
}
input:focus, select:focus { outline: none; border-color: var(--button); }

/* Term inputs */
.term-group { display: flex; flex-direction: column; gap: 0.3rem; }
.term-inputs { display: flex; gap: 0.6rem; }
.term-inputs input { flex: 1; }
.term-inputs select { flex: 0 0 90px; border-radius: 6px; }
@media (max-width: 380px) { .term-inputs { flex-direction: column; } .term-inputs select { width: 100%; flex: 1; } }

/* Submit button */
button[type="submit"] {
  background-color: var(--button);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  font-size: 1rem;
  padding: 0.55rem 0;
  cursor: pointer;
  transition: background-color 0.3s ease;
}
button[type="submit"]:hover { background-color: var(--highlight); }

/* Results section */
.results-section {
  flex-grow: 1;
  background-color: var(--panel-bg);
  border-radius: 10px;
  padding: 0.9rem 1rem 0.6rem;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
.results-section h2 {
  font-weight: 700;
  font-size: 1.2rem;
  margin-bottom: 0.4rem;
  color: var(--highlight);
}
.results-section p { font-size: 1rem; margin-bottom: 0.25rem; }

/* Chart styles */
.chart-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.3rem;
  flex-grow: 1;
  max-height: 190px;
  min-height: 170px;
}
canvas { width: 100%; max-width: 240px; max-height: 160px; height: auto; }
.chart-labels {
  display: flex;
  justify-content: center;
  gap: 1.5rem;
  font-weight: 700;
}
.label-item {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  white-space: nowrap;
}
.color-box { width: 16px; height: 16px; border-radius: 4px; }
.color-principal { background-color: #00b4db; }
.color-interest { background-color: #ff6384; }

/* Small screens */
@media (max-height: 550px) {
  h1 { font-size: 1.1rem; }
  label, input, select { font-size: 0.85rem; }
  button[type="submit"] { font-size: 0.9rem; padding: 0.45rem 0; }
  .results-section h2 { font-size: 1rem; }
  .chart-labels { font-size: 0.85rem; }
}
</style>
</head>
<body>
<div class="container">
  <div class="toggle-mode">
    <button onclick="toggleMode()" aria-label="Switch theme"><i class="fas fa-adjust"></i> Toggle Theme</button>
  </div>

  <h1>Loan Calculator</h1>

  <form id="loan-form" autocomplete="off" novalidate>
    <div class="input-group">
      <label for="amount">Loan Amount (₹)</label>
      <input type="number" id="amount" min="0" step="any" required>
    </div>

    <div class="input-group">
      <label for="interest">Interest Rate (%)</label>
      <input type="number" id="interest" min="0" step="any" required>
    </div>

    <div class="input-group term-group">
      <label for="term">Loan Duration</label>
      <div class="term-inputs">
        <input type="number" id="term" min="1" step="1" required>
        <select id="term-type">
          <option value="years">Years</option>
          <option value="months">Months</option>
        </select>
      </div>
    </div>

    <button type="submit">Calculate</button>
  </form>

  <section id="results" class="results-section" aria-live="polite" hidden>
    <h2>Loan Summary</h2>
    <p>Monthly Payment: <span id="monthly-payment">₹0.00</span></p>
    <p>Total Payment: <span id="total-payment">₹0.00</span></p>
    <p>Total Interest: <span id="total-interest">₹0.00</span></p>

    <div class="chart-container">
      <canvas id="loanChart" aria-hidden="true"></canvas>
      <div class="chart-labels" id="pieLabels"></div>
    </div>
  </section>
</div>

<script>
// ====== Dark/Light Mode ======
function toggleMode() {
  document.body.classList.toggle("dark-mode");
}

// ====== Loan Calculation ======
const loanForm = document.getElementById("loan-form");
const resultsSection = document.getElementById("results");
const monthlyEl = document.getElementById("monthly-payment");
const totalEl = document.getElementById("total-payment");
const interestEl = document.getElementById("total-interest");
const pieLabelsContainer = document.getElementById("pieLabels");
let loanChart;

loanForm.addEventListener("submit", (e) => {
  e.preventDefault();

  const principal = parseFloat(document.getElementById("amount").value);
  const rate = parseFloat(document.getElementById("interest").value);
  const termValue = parseFloat(document.getElementById("term").value);
  const termUnit = document.getElementById("term-type").value;

  if (!principal || principal <= 0 || rate < 0 || !termValue || termValue <= 0) {
    alert("Enter valid positive values for all fields.");
    resultsSection.hidden = true;
    return;
  }

  const months = termUnit === "years" ? termValue * 12 : termValue;
  const monthlyRate = rate / 100 / 12;

  let monthlyPayment = monthlyRate === 0 
    ? principal / months 
    : (principal * monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);

  if (!isFinite(monthlyPayment)) {
    alert("Calculation error. Check your inputs.");
    resultsSection.hidden = true;
    return;
  }

  const totalPayment = monthlyPayment * months;
  const totalInterest = totalPayment - principal;

  monthlyEl.textContent = `₹${monthlyPayment.toLocaleString("en-IN", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
  totalEl.textContent = `₹${totalPayment.toLocaleString("en-IN", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
  interestEl.textContent = `₹${totalInterest.toLocaleString("en-IN", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

  resultsSection.hidden = false;
  renderChart(principal, totalInterest);
  renderPieLabels(principal, totalInterest);
});

// ====== Pie Chart ======
function renderChart(principal, interest) {
  const ctx = document.getElementById("loanChart").getContext("2d");
  if (loanChart) loanChart.destroy();

  loanChart = new Chart(ctx, {
    type: "pie",
    data: {
      labels: ["Principal", "Interest"],
      datasets: [{ data: [principal, interest], backgroundColor: ["#00b4db","#ff6384"], borderWidth: 0 }]
    },
    options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{display:false}, tooltip:{enabled:true} } }
  });
}

// ====== Pie Labels ======
function renderPieLabels(principal, interest) {
  pieLabelsContainer.innerHTML = "";
  const total = principal + interest;

  const labels = [
    { colorClass: "color-principal", text: "Principal", value: principal },
    { colorClass: "color-interest", text: "Interest", value: interest }
  ];

  labels.forEach(item => {
    const percent = ((item.value / total) * 100).toFixed(1);
    const labelDiv = document.createElement("div");
    labelDiv.classList.add("pie-label");
    labelDiv.innerHTML = `<div class="color-box ${item.colorClass}"></div> ${item.text}: ${percent}%`;
    pieLabelsContainer.appendChild(labelDiv);
  });
}
</script>
</body>
</html>
